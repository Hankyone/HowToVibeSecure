<section class="slide" id="server-calls" data-color="teal" tabindex="-1">
  <h2>Server‑Side API Calls</h2>
  
  <div class="ssrf-layout">
    <div class="ssrf-content">
      <div class="ssrf-explanation">
        <h3>The SSRF Attack Scenario</h3>
        <p><strong>Your server fetches URLs from user input:</strong></p>
        <ul class="scenario-examples">
          <li>📸 "Import from Instagram" → <code>fetch(userUrl)</code></li>
          <li>🪝 Webhook callbacks → <code>fetch(webhookUrl)</code></li>
          <li>🤖 AI scraping user links → <code>fetch(docUrl)</code></li>
          <li>📊 "Load data from CSV URL" → <code>fetch(csvUrl)</code></li>
        </ul>
        
        <div class="attack-examples">
          <h4>🚨 Attacker's Goal: Make Your Server Hit Internal Targets</h4>
          <ul>
            <li><code>169.254.169.254</code> - Steal AWS credentials</li>
            <li><code>localhost:3000</code> - Hit admin panel from inside</li>
            <li><code>192.168.1.1</code> - Access internal network</li>
          </ul>
        </div>
        
        <div class="key-rules">
          <h4>🛡️ Protection Rules:</h4>
          <ul>
            <li>Use an outbound allowlist (exact hosts)</li>
            <li>Block private/loopback/metadata IPs</li>
            <li>Only allow http/https on standard ports</li>
            <li>Disallow redirects/userinfo tricks</li>
          </ul>
        </div>
      </div>
    </div>
    
    <div class="ssrf-demo-panel">
      <div id="ssrfDemo" class="demo">
        <h4>🧪 Simulate: User Provides URL to Your Server</h4>
        <div class="scenario-context">
          <p><strong>Scenario:</strong> User says "Import my data from this URL"</p>
          <p><strong>Your code:</strong> <code>const response = await fetch(userProvidedUrl)</code></p>
          <p><strong>Question:</strong> Should your server make this request?</p>
        </div>
        
        <div class="ssrf-samples">
          <button onclick="document.querySelector('#ssrfDemo input').value='https://example.com/api'; testSSRF(document.querySelector('#ssrfDemo button'))">✅ Safe URL</button>
          <button onclick="document.querySelector('#ssrfDemo input').value='http://localhost:3000/admin'; testSSRF(document.querySelector('#ssrfDemo button'))">❌ Internal Target</button>
          <button onclick="document.querySelector('#ssrfDemo input').value='http://169.254.169.254/metadata'; testSSRF(document.querySelector('#ssrfDemo button'))">❌ Cloud Metadata</button>
        </div>
        
        <div class="ssrf-input-row">
          <input type="url" placeholder="Enter URL to fetch..." />
          <button onclick="testSSRF(this)">Test Fetch</button>
        </div>
        <div class="ssrf-results"></div>
      </div>
    </div>
  </div>
</section>